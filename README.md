# llm_arithmetic

![image](https://github.com/user-attachments/assets/57ec6e30-0e0c-41c2-be6f-3acd2bc12d9d)

A Python harness to evaluate Large Language Models (LLMs) on basic arithmetic operations (addition, subtraction, multiplication, division) across varying numeric depths (number of digits in numbers) and data types (integer, fixed-point denotaed as float). 

E.g. integer at depth 2:
```
Compute the following and reply with just the numeric result (no explanation):
   23 + 48
```

E.g. float at depth 5:
```
Compute the following and reply with just the numeric result (no explanation):
   82248.19 * 96362.66
```

## Features

- Supports integer and fixed-point "float" arithmetic
- Parametrized digit depths (2 to 10)
- Generates random test operands with controlled valid inputs (e.g., integer division always yields integer results)
- Prompts LLMs via `litellm`
- Parses numeric responses with regex
- Classifies results as `Correct` (exact match), `Deviate`, or `NaN` (not a number in model response)
- Records token usage and costs
- Outputs per-trial JSONL and updates an aggregate JSONL summary

## Testing Rules and Constraints

- **Integer operands**:
  - Depth *d*: values from $10^{d-1}$ to $10^d - 1$
  - `int_div` pairs are constructed so division yields an exact integer result

- **Floating-point operands**:
  - Inputs have two decimal places (fixed-point scale 0.01)
  - Depth *d*: base magnitudes from $10^{d-1}$ to $10^d - 1$ before scaling
  - Addition/Subtraction: exact two decimal places
  - Multiplication/Division: results quantized to four decimal places

- **Prompting & parsing**:
  - Models receive: "Compute the following and reply with just the numeric result (no explanation)"
  - Responses are parsed via regex and classified as:
    - `Correct`: exact match to the computed result
    - `Deviate`: numeric but off – logged with absolute error
    - `NaN`: non-numeric or parsing failure

- **Trials & depths**:
  - Default 10 trials per variant/depth combination
  - Default depths: 2 through 10 digits

- **Outputs**:
  - Per-trial JSONL written to the configured results directory
  - A summary record appended to `aggregate.jsonl` at project root

## Results
- `grok-3-mini-beta-high` reasoning tokens wre not reghistered, price is incorrect
- It's reasonable to do a non-strict verification, currently there's strict match of response, yet sometimes models do not follow the rules and can wrap correct replies in some markup (e.g. most of NaN results for `grok-3-mini-beta-high` are actully correct) - a separate metric for format adherence can be tracked
- `gemini-2.5-flash-preview-04-17-??thinking` - seems Google AI Studio disregarded the provided htinking params

```
                                                                Models Overview                                                                
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Model                                     ┃ Date             ┃ Trials ┃ Correct % ┃  NaN % ┃  Dev % ┃       Cost ┃                Avg Error ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ claude-3-7-sonnet-20250219                │ 2025-05-11_19-06 │    480 │    51.04% │  0.00% │ 48.96% │  $0.114204 │      1256291313492864.50 │
│ claude-3-7-sonnet-20250219-thinking4096   │ 2025-05-11_19-20 │    480 │    57.08% │ 18.96% │ 23.96% │ $18.306354 │    773109131839652992.00 │
│ claude-v3-5-haiku                         │ 2025-05-12_13-40 │    480 │    49.58% │  0.00% │ 50.42% │  $0.029816 │ 309550101099442143232.00 │
│ deepseek-r1                               │ 2025-05-12_13-35 │    480 │    84.17% │  0.21% │ 15.62% │  $3.210413 │ 154039382084726128640.00 │
│ gemini-2.5-flash-preview-04-17            │ 2025-05-12_10-15 │    480 │    50.42% │  0.21% │ 49.38% │  $0.315585 │   1670226792174047744.00 │
│ gemini-2.5-flash-preview-04-17-??thinking │ 2025-05-12_12-28 │    480 │    49.79% │  0.21% │ 50.00% │  $1.087891 │   1673196184364916480.00 │
│ gemini-2.5-pro-preview-03-25              │ 2025-05-12_13-31 │    480 │    55.83% │  0.00% │ 44.17% │  $0.078019 │    489039253224715008.00 │
│ gpt-4.1-2025-04-14                        │ 2025-05-11_16-17 │    480 │    48.12% │  0.00% │ 51.88% │  $0.068629 │ 142772341522668371968.00 │
│ gpt-4.1-nano-2025-04-14                   │ 2025-05-11_16-04 │    480 │    38.54% │  0.42% │ 61.04% │  $0.002750 │  83620826458468040704.00 │
│ gpt-4o-mini-2024-07-18                    │ 2025-05-11_16-17 │    480 │    32.29% │  0.00% │ 67.71% │  $0.004137 │     40384625659291632.00 │
│ grok-3-mini-beta                          │ 2025-05-11_19-53 │    480 │    51.46% │  0.00% │ 48.54% │  $0.006060 │ 269577858689370947584.00 │
│ grok-3-mini-beta-high                     │ 2025-05-12_06-52 │    480 │    71.88% │  1.25% │ 26.88% │  $0.006156 │   3211229392017596416.00 │
│ o4-mini-2025-04-16-medium                 │ 2025-05-11_16-17 │    480 │    97.08% │  0.00% │  2.92% │  $4.903872 │               1703248.79 │
└───────────────────────────────────────────┴──────────────────┴────────┴───────────┴────────┴────────┴────────────┴──────────────────────────┘
╭────────────────────────────────────────── Overall (claude-3-7-sonnet-20250219 @ 2025-05-11_19-06) ───────────────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 51.04%                                                                                                                             │
│ Nan Rate: 0.00%                                                                                                                              │
│ Deviate Rate: 48.96%                                                                                                                         │
│ Total Prompt Tokens: 17333.0                                                                                                                 │
│ Total Completion Tokens: 4147.0                                                                                                              │
│ Total Cost: $0.114204                                                                                                                        │
│ Avg Error: 1256291313492864.50                                                                                                               │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                   Per-Variant Summary (claude-3-7-sonnet-20250219)                   
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃ NaN % ┃   Dev % ┃           Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │   100.00% │ 0.00% │   0.00% │                0.00 │ $0.012180 │
│ int_sub   │     60 │   100.00% │ 0.00% │   0.00% │                0.00 │ $0.011955 │
│ int_mul   │     60 │     0.00% │ 0.00% │ 100.00% │  156236692537757.19 │ $0.014250 │
│ int_div   │     60 │    10.00% │ 0.00% │  90.00% │     167960201953.96 │ $0.013071 │
│ float_add │     60 │   100.00% │ 0.00% │   0.00% │                0.00 │ $0.014745 │
│ float_sub │     60 │    98.33% │ 0.00% │   1.67% │           100000.00 │ $0.014460 │
│ float_mul │     60 │     0.00% │ 0.00% │ 100.00% │ 4764009272383390.00 │ $0.017385 │
│ float_div │     60 │     0.00% │ 0.00% │ 100.00% │      77182075813.28 │ $0.016158 │
└───────────┴────────┴───────────┴───────┴─────────┴─────────────────────┴───────────┘
╭──────────────────────────────────── Overall (claude-3-7-sonnet-20250219-thinking4096 @ 2025-05-11_19-20) ────────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 57.08%                                                                                                                             │
│ Nan Rate: 18.96%                                                                                                                             │
│ Deviate Rate: 23.96%                                                                                                                         │
│ Total Prompt Tokens: 30773.0                                                                                                                 │
│ Total Completion Tokens: 1214269.0                                                                                                           │
│ Total Cost: $18.306354                                                                                                                       │
│ Avg Error: 773109131839652992.00                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
              Per-Variant Summary (claude-3-7-sonnet-20250219-thinking4096)              
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃  NaN % ┃  Dev % ┃              Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │    98.33% │  1.67% │  0.00% │                   0.00 │ $1.034025 │
│ int_sub   │     60 │    91.67% │  8.33% │  0.00% │                   0.00 │ $1.999080 │
│ int_mul   │     60 │    28.33% │ 48.33% │ 23.33% │     126243695304323.50 │ $3.350805 │
│ int_div   │     60 │    40.00% │ 26.67% │ 33.33% │           364464358.45 │ $2.882943 │
│ float_add │     60 │    96.67% │  3.33% │  0.00% │                   0.00 │ $1.381290 │
│ float_sub │     60 │    96.67% │  3.33% │  0.00% │                   0.00 │ $1.726350 │
│ float_mul │     60 │     3.33% │ 48.33% │ 48.33% │ 3065714696705712640.00 │ $3.347685 │
│ float_div │     60 │     1.67% │ 11.67% │ 86.67% │       1087270594215.36 │ $2.584176 │
└───────────┴────────┴───────────┴────────┴────────┴────────────────────────┴───────────┘
╭─────────────────────────────────────────────── Overall (claude-v3-5-haiku @ 2025-05-12_13-40) ───────────────────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 49.58%                                                                                                                             │
│ Nan Rate: 0.00%                                                                                                                              │
│ Deviate Rate: 50.42%                                                                                                                         │
│ Total Prompt Tokens: 17335.0                                                                                                                 │
│ Total Completion Tokens: 3987.0                                                                                                              │
│ Total Cost: $0.029816                                                                                                                        │
│ Avg Error: 309550101099442143232.00                                                                                                          │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                          Per-Variant Summary (claude-v3-5-haiku)                           
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃ NaN % ┃   Dev % ┃                 Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │   100.00% │ 0.00% │   0.00% │                      0.00 │ $0.003272 │
│ int_sub   │     60 │   100.00% │ 0.00% │   0.00% │                      0.00 │ $0.003188 │
│ int_mul   │     60 │     0.00% │ 0.00% │ 100.00% │       3109145483485132.50 │ $0.003816 │
│ int_div   │     60 │     0.00% │ 0.00% │ 100.00% │             1010908922.08 │ $0.003235 │
│ float_add │     60 │    96.67% │ 0.00% │   3.33% │                    500.50 │ $0.003920 │
│ float_sub │     60 │   100.00% │ 0.00% │   0.00% │                      0.00 │ $0.003840 │
│ float_mul │     60 │     0.00% │ 0.00% │ 100.00% │ 1248515631851058757632.00 │ $0.004660 │
│ float_div │     60 │     0.00% │ 0.00% │ 100.00% │           103530060938.28 │ $0.003885 │
└───────────┴────────┴───────────┴───────┴─────────┴───────────────────────────┴───────────┘
╭────────────────────────────────────────────────── Overall (deepseek-r1 @ 2025-05-12_13-35) ──────────────────────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 84.17%                                                                                                                             │
│ Nan Rate: 0.21%                                                                                                                              │
│ Deviate Rate: 15.62%                                                                                                                         │
│ Total Prompt Tokens: 13610.0                                                                                                                 │
│ Total Completion Tokens: 1462524.0                                                                                                           │
│ Total Cost: $3.210413                                                                                                                        │
│ Avg Error: 154039382084726128640.00                                                                                                          │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                             Per-Variant Summary (deepseek-r1)                             
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃ NaN % ┃  Dev % ┃                 Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │    96.67% │ 0.00% │  3.33% │                 815000.00 │ $0.135823 │
│ int_sub   │     60 │   100.00% │ 0.00% │  0.00% │                      0.00 │ $0.174805 │
│ int_mul   │     60 │    85.00% │ 0.00% │ 15.00% │ 1283638721211850031104.00 │ $0.603125 │
│ int_div   │     60 │    86.67% │ 0.00% │ 13.33% │             1129364838.87 │ $0.497853 │
│ float_add │     60 │    96.67% │ 0.00% │  3.33% │                    500.50 │ $0.157533 │
│ float_sub │     60 │   100.00% │ 0.00% │  0.00% │                      0.00 │ $0.233967 │
│ float_mul │     60 │    60.00% │ 1.67% │ 38.33% │       8920236467799694.00 │ $0.805484 │
│ float_div │     60 │    48.33% │ 0.00% │ 51.67% │                 396266.75 │ $0.601822 │
└───────────┴────────┴───────────┴───────┴────────┴───────────────────────────┴───────────┘
╭──────────────────────────────────────── Overall (gemini-2.5-flash-preview-04-17 @ 2025-05-12_10-15) ─────────────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 50.42%                                                                                                                             │
│ Nan Rate: 0.21%                                                                                                                              │
│ Deviate Rate: 49.38%                                                                                                                         │
│ Total Prompt Tokens: 18763.0                                                                                                                 │
│ Total Completion Tokens: 521284.0                                                                                                            │
│ Total Cost: $0.315585                                                                                                                        │
│ Avg Error: 1670226792174047744.00                                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                  Per-Variant Summary (gemini-2.5-flash-preview-04-17)                   
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃ NaN % ┃   Dev % ┃              Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │    96.67% │ 0.00% │   3.33% │            68945000.00 │ $0.020716 │
│ int_sub   │     60 │    95.00% │ 0.00% │   5.00% │            24329033.33 │ $0.050069 │
│ int_mul   │     60 │     3.33% │ 0.00% │  96.67% │ 3333643387307662336.00 │ $0.053077 │
│ int_div   │     60 │    13.33% │ 0.00% │  86.67% │            21068587.12 │ $0.013442 │
│ float_add │     60 │    98.33% │ 0.00% │   1.67% │                   1.00 │ $0.042125 │
│ float_sub │     60 │    96.67% │ 0.00% │   3.33% │          1350260000.00 │ $0.045192 │
│ float_mul │     60 │     0.00% │ 0.00% │ 100.00% │ 3374873811874167808.00 │ $0.016628 │
│ float_div │     60 │     0.00% │ 1.67% │  98.33% │         77371998547.45 │ $0.074335 │
└───────────┴────────┴───────────┴───────┴─────────┴────────────────────────┴───────────┘
╭─────────────────────────────────── Overall (gemini-2.5-flash-preview-04-17-??thinking @ 2025-05-12_12-28) ───────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 49.79%                                                                                                                             │
│ Nan Rate: 0.21%                                                                                                                              │
│ Deviate Rate: 50.00%                                                                                                                         │
│ Total Prompt Tokens: 18762.0                                                                                                                 │
│ Total Completion Tokens: 310022.0                                                                                                            │
│ Total Cost: $1.087891                                                                                                                        │
│ Avg Error: 1673196184364916480.00                                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
             Per-Variant Summary (gemini-2.5-flash-preview-04-17-??thinking)             
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃ NaN % ┃   Dev % ┃              Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │    96.67% │ 0.00% │   3.33% │           373275000.00 │ $0.089321 │
│ int_sub   │     60 │    96.67% │ 0.00% │   3.33% │           693881450.00 │ $0.128000 │
│ int_mul   │     60 │     1.67% │ 0.00% │  98.33% │ 2109324541330623232.00 │ $0.065875 │
│ int_div   │     60 │     8.33% │ 0.00% │  91.67% │        100837550965.33 │ $0.072629 │
│ float_add │     60 │   100.00% │ 0.00% │   0.00% │                   0.00 │ $0.133343 │
│ float_sub │     60 │    95.00% │ 0.00% │   5.00% │              406666.67 │ $0.150451 │
│ float_mul │     60 │     0.00% │ 0.00% │ 100.00% │ 4618615407374022656.00 │ $0.089155 │
│ float_div │     60 │     0.00% │ 1.67% │  98.33% │        107092049913.21 │ $0.359117 │
└───────────┴────────┴───────────┴───────┴─────────┴────────────────────────┴───────────┘
╭───────────────────────────────────────── Overall (gemini-2.5-pro-preview-03-25 @ 2025-05-12_13-31) ──────────────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 55.83%                                                                                                                             │
│ Nan Rate: 0.00%                                                                                                                              │
│ Deviate Rate: 44.17%                                                                                                                         │
│ Total Prompt Tokens: 18279.0                                                                                                                 │
│ Total Completion Tokens: 5517.0                                                                                                              │
│ Total Cost: $0.078019                                                                                                                        │
│ Avg Error: 489039253224715008.00                                                                                                             │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                   Per-Variant Summary (gemini-2.5-pro-preview-03-25)                    
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃ NaN % ┃   Dev % ┃              Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │   100.00% │ 0.00% │   0.00% │                   0.00 │ $0.007355 │
│ int_sub   │     60 │   100.00% │ 0.00% │   0.00% │                   0.00 │ $0.007235 │
│ int_mul   │     60 │    13.33% │ 0.00% │  86.67% │ 1977515428762519808.00 │ $0.011225 │
│ int_div   │     60 │    35.00% │ 0.00% │  65.00% │           254953162.56 │ $0.007760 │
│ float_add │     60 │    98.33% │ 0.00% │   1.67% │               60000.00 │ $0.009565 │
│ float_sub │     60 │   100.00% │ 0.00% │   0.00% │                   0.00 │ $0.009375 │
│ float_mul │     60 │     0.00% │ 0.00% │ 100.00% │   14091950896222280.00 │ $0.014485 │
│ float_div │     60 │     0.00% │ 0.00% │ 100.00% │         38737866430.42 │ $0.011019 │
└───────────┴────────┴───────────┴───────┴─────────┴────────────────────────┴───────────┘
╭────────────────────────────────────────────── Overall (gpt-4.1-2025-04-14 @ 2025-05-11_16-17) ───────────────────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 48.12%                                                                                                                             │
│ Nan Rate: 0.00%                                                                                                                              │
│ Deviate Rate: 51.88%                                                                                                                         │
│ Total Prompt Tokens: 16137.0                                                                                                                 │
│ Total Completion Tokens: 2729.0                                                                                                              │
│ Total Cost: $0.068629                                                                                                                        │
│ Avg Error: 142772341522668371968.00                                                                                                          │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                         Per-Variant Summary (gpt-4.1-2025-04-14)                          
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃ NaN % ┃   Dev % ┃                Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │   100.00% │ 0.00% │   0.00% │                     0.00 │ $0.007248 │
│ int_sub   │     60 │    96.67% │ 0.00% │   3.33% │                 50050.00 │ $0.007392 │
│ int_mul   │     60 │     0.00% │ 0.00% │ 100.00% │  16098010107276904448.00 │ $0.008376 │
│ int_div   │     60 │     3.33% │ 0.00% │  96.67% │              16836311.76 │ $0.007675 │
│ float_add │     60 │    93.33% │ 0.00% │   6.67% │                   525.25 │ $0.008912 │
│ float_sub │     60 │    91.67% │ 0.00% │   8.33% │                200040.40 │ $0.009064 │
│ float_mul │     60 │     0.00% │ 0.00% │ 100.00% │ 576407207104578453504.00 │ $0.010400 │
│ float_div │     60 │     0.00% │ 0.00% │ 100.00% │          107202130046.65 │ $0.009562 │
└───────────┴────────┴───────────┴───────┴─────────┴──────────────────────────┴───────────┘
╭──────────────────────────────────────────── Overall (gpt-4.1-nano-2025-04-14 @ 2025-05-11_16-04) ────────────────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 38.54%                                                                                                                             │
│ Nan Rate: 0.42%                                                                                                                              │
│ Deviate Rate: 61.04%                                                                                                                         │
│ Total Prompt Tokens: 16131.0                                                                                                                 │
│ Total Completion Tokens: 2841.0                                                                                                              │
│ Total Cost: $0.002750                                                                                                                        │
│ Avg Error: 83620826458468040704.00                                                                                                           │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                       Per-Variant Summary (gpt-4.1-nano-2025-04-14)                       
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃ NaN % ┃   Dev % ┃                Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │    75.00% │ 0.00% │  25.00% │               4961559.33 │ $0.000283 │
│ int_sub   │     60 │    76.67% │ 0.00% │  23.33% │            3245540414.28 │ $0.000284 │
│ int_mul   │     60 │     0.00% │ 0.00% │ 100.00% │ 401666426228747599872.00 │ $0.000340 │
│ int_div   │     60 │     0.00% │ 1.67% │  98.33% │         3574462468383.27 │ $0.000318 │
│ float_add │     60 │    76.67% │ 0.00% │  23.33% │              62164943.79 │ $0.000355 │
│ float_sub │     60 │    80.00% │ 0.00% │  20.00% │             202900457.50 │ $0.000358 │
│ float_mul │     60 │     0.00% │ 0.00% │ 100.00% │   6681517892744272896.00 │ $0.000424 │
│ float_div │     60 │     0.00% │ 1.67% │  98.33% │       428713551167781.12 │ $0.000388 │
└───────────┴────────┴───────────┴───────┴─────────┴──────────────────────────┴───────────┘
╭──────────────────────────────────────────── Overall (gpt-4o-mini-2024-07-18 @ 2025-05-11_16-17) ─────────────────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 32.29%                                                                                                                             │
│ Nan Rate: 0.00%                                                                                                                              │
│ Deviate Rate: 67.71%                                                                                                                         │
│ Total Prompt Tokens: 16133.0                                                                                                                 │
│ Total Completion Tokens: 2862.0                                                                                                              │
│ Total Cost: $0.004137                                                                                                                        │
│ Avg Error: 40384625659291632.00                                                                                                              │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                      Per-Variant Summary (gpt-4o-mini-2024-07-18)                      
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃ NaN % ┃   Dev % ┃             Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │    53.33% │ 0.00% │  46.67% │            7934467.86 │ $0.000422 │
│ int_sub   │     60 │    71.67% │ 0.00% │  28.33% │           97670007.82 │ $0.000428 │
│ int_mul   │     60 │     0.00% │ 0.00% │ 100.00% │  10700820223845594.00 │ $0.000511 │
│ int_div   │     60 │     0.00% │ 0.00% │ 100.00% │          724434006.18 │ $0.000484 │
│ float_add │     60 │    55.00% │ 0.00% │  45.00% │           13005000.00 │ $0.000527 │
│ float_sub │     60 │    78.33% │ 0.00% │  21.67% │          105207413.77 │ $0.000536 │
│ float_mul │     60 │     0.00% │ 0.00% │ 100.00% │ 208049169231312192.00 │ $0.000637 │
│ float_div │     60 │     0.00% │ 0.00% │ 100.00% │        65414881462.89 │ $0.000591 │
└───────────┴────────┴───────────┴───────┴─────────┴───────────────────────┴───────────┘
╭─────────────────────────────────────────────── Overall (grok-3-mini-beta @ 2025-05-11_19-53) ────────────────────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 51.46%                                                                                                                             │
│ Nan Rate: 0.00%                                                                                                                              │
│ Deviate Rate: 48.54%                                                                                                                         │
│ Total Prompt Tokens: 16016.0                                                                                                                 │
│ Total Completion Tokens: 2511.0                                                                                                              │
│ Total Cost: $0.006060                                                                                                                        │
│ Avg Error: 269577858689370947584.00                                                                                                          │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                          Per-Variant Summary (grok-3-mini-beta)                           
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃ NaN % ┃  Dev % ┃                 Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │    86.67% │ 0.00% │ 13.33% │             1701789587.50 │ $0.000675 │
│ int_sub   │     60 │    93.33% │ 0.00% │  6.67% │              220055900.00 │ $0.000678 │
│ int_mul   │     60 │    35.00% │ 0.00% │ 65.00% │ 1606686972011327782912.00 │ $0.000740 │
│ int_div   │     60 │    18.33% │ 0.00% │ 81.67% │              639106963.71 │ $0.000701 │
│ float_add │     60 │    88.33% │ 0.00% │ 11.67% │            13516570822.14 │ $0.000806 │
│ float_sub │     60 │    86.67% │ 0.00% │ 13.33% │             1045584516.38 │ $0.000811 │
│ float_mul │     60 │     1.67% │ 0.00% │ 98.33% │    2556753590877732352.00 │ $0.000846 │
│ float_div │     60 │     1.67% │ 0.00% │ 98.33% │         11935102788674.27 │ $0.000805 │
└───────────┴────────┴───────────┴───────┴────────┴───────────────────────────┴───────────┘
╭───────────────────────────────────────────── Overall (grok-3-mini-beta-high @ 2025-05-12_06-52) ─────────────────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 71.88%                                                                                                                             │
│ Nan Rate: 1.25%                                                                                                                              │
│ Deviate Rate: 26.88%                                                                                                                         │
│ Total Prompt Tokens: 16016.0                                                                                                                 │
│ Total Completion Tokens: 2702.0                                                                                                              │
│ Total Cost: $0.006156                                                                                                                        │
│ Avg Error: 3211229392017596416.00                                                                                                            │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
                      Per-Variant Summary (grok-3-mini-beta-high)                       
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃ NaN % ┃  Dev % ┃              Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │    86.67% │ 5.00% │  8.33% │              926612.00 │ $0.000678 │
│ int_sub   │     60 │    95.00% │ 1.67% │  3.33% │          2219003750.00 │ $0.000695 │
│ int_mul   │     60 │    46.67% │ 0.00% │ 53.33% │  591805544460579840.00 │ $0.000740 │
│ int_div   │     60 │    76.67% │ 0.00% │ 23.33% │          5090524126.14 │ $0.000710 │
│ float_add │     60 │    96.67% │ 1.67% │  1.67% │               94000.00 │ $0.000808 │
│ float_sub │     60 │    98.33% │ 1.67% │  0.00% │                   0.00 │ $0.000813 │
│ float_mul │     60 │    33.33% │ 0.00% │ 66.67% │ 9882770261179013120.00 │ $0.000878 │
│ float_div │     60 │    41.67% │ 0.00% │ 58.33% │        103561738182.47 │ $0.000833 │
└───────────┴────────┴───────────┴───────┴────────┴────────────────────────┴───────────┘
╭─────────────────────────────────────────── Overall (o4-mini-2025-04-16-medium @ 2025-05-11_16-17) ───────────────────────────────────────────╮
│ Total Trials: 480                                                                                                                            │
│ Accuracy: 97.08%                                                                                                                             │
│ Nan Rate: 0.00%                                                                                                                              │
│ Deviate Rate: 2.92%                                                                                                                          │
│ Total Prompt Tokens: 15653.0                                                                                                                 │
│ Total Completion Tokens: 1110603.0                                                                                                           │
│ Total Cost: $4.903872                                                                                                                        │
│ Avg Error: 1703248.79                                                                                                                        │
╰──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
              Per-Variant Summary (o4-mini-2025-04-16-medium)               
┏━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━━━━┓
┃ Variant   ┃ Trials ┃ Correct % ┃ NaN % ┃  Dev % ┃  Avg Error ┃      Cost ┃
┡━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━━━━┩
│ int_add   │     60 │   100.00% │ 0.00% │  0.00% │       0.00 │ $0.147184 │
│ int_sub   │     60 │   100.00% │ 0.00% │  0.00% │       0.00 │ $0.127820 │
│ int_mul   │     60 │   100.00% │ 0.00% │  0.00% │       0.00 │ $0.627365 │
│ int_div   │     60 │   100.00% │ 0.00% │  0.00% │       0.00 │ $0.856805 │
│ float_add │     60 │   100.00% │ 0.00% │  0.00% │       0.00 │ $0.075860 │
│ float_sub │     60 │   100.00% │ 0.00% │  0.00% │       0.00 │ $0.095352 │
│ float_mul │     60 │    98.33% │ 0.00% │  1.67% │ 1099989.00 │ $1.195872 │
│ float_div │     60 │    78.33% │ 0.00% │ 21.67% │ 1749653.39 │ $1.777612 │
└───────────┴────────┴───────────┴───────┴────────┴────────────┴───────────┘
```

## Installation

1. Clone the repository

```bash
 git clone <repo_url>
 cd llm_arithmetic
```

2. Install dependencies

```bash
 pip install -r requirements.txt
```

3. Set your API key environment variable

```bash
 export OPENAI_API_KEY="your-api-key"
```

Alternatively, create a `.env` file at the project root with the following content:

```env
 OPENAI_API_KEY=your-api-key
 MODEL=openai/gpt-4o
```

## Usage

Run the evaluation suite with:

```bash
 python run.py --model <model> --trials 10 --depths 2 3 4 5 6 7 8 9 10 --output_dir results
```

To resume an interrupted run, point `--resume_file` at the existing trials JSONL:

```bash
 python run.py --model <model> --trials 10 --depths 2 3 4 5 6 7 8 9 10 --output_dir results \
     --resume_file results/<model>_<date>.jsonl
```

By default the harness will retry failed LLM calls 3 times; override with `--retries <N>`:

```bash
 python run.py --model <model> --trials 10 --depths 2 3 --output_dir results \
     --resume_file results/<model>_<date>.jsonl --retries 5
```
